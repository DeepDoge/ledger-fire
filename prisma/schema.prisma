// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Transaction {
  id        BigInt @id @default(autoincrement())
  from      Bytes
  method    String
  data      Bytes
  timestamp BigInt

  StockMove StockMove[]

  @@index([from])
}

model Indexing {
  id       BigInt @id @default(0)
  nextTxId BigInt @default(0)
}

model Warehouse {
  id BigInt @id @default(autoincrement())

  name       String
  address    String
  stocks     Stock[]
  stockMoves StockMove[]
}

model Brand {
  id BigInt @id

  name     String
  products Product[]
}

model Product {
  id BigInt @id @default(autoincrement())

  name  String
  brand Brand  @relation(fields: [brandId], references: [id])

  brandId BigInt

  stocks     Stock[]
  stockMoves StockMove[]

  SupplierProduct SupplierProduct[]
}

model Stock {
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
  product   Product   @relation(fields: [productId], references: [id])
  quantity  BigInt

  warehouseId BigInt
  productId   BigInt

  stockMoves StockMove[]

  @@id([warehouseId, productId])
}

model StockMove {
  id   BigInt      @id @default(autoincrement())
  tx   Transaction @relation(fields: [txId], references: [id])
  txId BigInt

  stock     Stock     @relation(fields: [warehouseId, productId], references: [warehouseId, productId])
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
  product   Product   @relation(fields: [productId], references: [id])
  quantity  BigInt

  warehouseId BigInt
  productId   BigInt
}

model Account {
  id BigInt @id @default(autoincrement())

  governmentId String? @unique
  fullName     String
  nickname     String?
  address      String?
  email        String?
  phone        String?

  Supplier Supplier?
}

model Supplier {
  account   Account @relation(fields: [accountId], references: [id])
  accountId BigInt  @id

  SupplierProduct SupplierProduct[]
}

model SupplierProduct {
  id         BigInt   @id @default(autoincrement())
  supplier   Supplier @relation(fields: [supplierId], references: [accountId])
  supplierId BigInt

  name    String
  code    String
  barcode String

  product   Product? @relation(fields: [productId], references: [id])
  productId BigInt?

  @@unique([supplierId, code])
  @@unique([supplierId, barcode])
}
